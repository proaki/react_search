{"ast":null,"code":"Object.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _extends = Object.assign || function (target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i];\n\n    for (var key in source) {\n      if (Object.prototype.hasOwnProperty.call(source, key)) {\n        target[key] = source[key];\n      }\n    }\n  }\n\n  return target;\n};\n\nexports.loadPopularSuggestions = loadPopularSuggestions;\nexports.executeQuery = executeQuery;\nexports.setQueryOptions = setQueryOptions;\nexports.updateQuery = updateQuery;\nexports.loadMore = loadMore;\n\nvar _value = require('./value');\n\nvar _utils = require('./utils');\n\nvar _hits = require('./hits');\n\nvar _misc = require('./misc');\n\nvar _helper = require('../utils/helper');\n\nvar _analytics = require('../utils/analytics');\n\nvar _analytics2 = _interopRequireDefault(_analytics);\n\nvar _maps = require('./maps');\n\nvar _graphQL = require('../utils/graphQL');\n\nvar _graphQL2 = _interopRequireDefault(_graphQL);\n\nvar _constants = require('../utils/constants');\n\nvar _transform = require('../utils/transform');\n\nvar _transform2 = require('../../lib/utils/transform');\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n\nfunction _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nfunction _toConsumableArray(arr) {\n  if (Array.isArray(arr)) {\n    for (var i = 0, arr2 = Array(arr.length); i < arr.length; i++) {\n      arr2[i] = arr[i];\n    }\n\n    return arr2;\n  } else {\n    return Array.from(arr);\n  }\n}\n\nfunction loadPopularSuggestions(componentId) {\n  return function (dispatch, getState) {\n    var _getState = getState(),\n        config = _getState.config,\n        appbaseRef = _getState.appbaseRef,\n        props = _getState.props,\n        internalValues = _getState.internalValues;\n\n    var isAppbaseEnabled = config && config.enableAppbase;\n    var componentProps = props[componentId] || {};\n    var internalValue = internalValues[componentId];\n    var value = internalValue && internalValue.value || '';\n\n    if (isAppbaseEnabled && (componentProps.enablePopularSuggestions || componentProps.enableQuerySuggestions)) {\n      var suggQuery = (0, _utils.getSuggestionQuery)(getState, componentId);\n      appbaseRef.getQuerySuggestions(suggQuery).then(function (suggestions) {\n        var querySuggestion = suggestions[(0, _utils.getQuerySuggestionsId)(componentId)];\n\n        if (value) {\n          dispatch((0, _misc.setPopularSuggestions)(querySuggestion && querySuggestion.hits && querySuggestion.hits.hits, componentId.split('__internal')[0]));\n        } else {\n          dispatch((0, _misc.setDefaultPopularSuggestions)(querySuggestion && querySuggestion.hits && querySuggestion.hits.hits, componentId.split('__internal')[0]));\n        }\n      }).catch(function (e) {\n        (0, _utils.handleError)({\n          orderOfQueries: [componentId],\n          error: e\n        }, getState, dispatch);\n      });\n    }\n  };\n}\n\nfunction msearch(query, orderOfQueries) {\n  var appendToHits = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;\n  var isInternalComponent = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : false;\n  var appendToAggs = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : false;\n  var componentType = arguments[5];\n  return function (dispatch, getState) {\n    var _getState2 = getState(),\n        appbaseRef = _getState2.appbaseRef,\n        config = _getState2.config,\n        headers = _getState2.headers,\n        analytics = _getState2.analytics,\n        selectedValues = _getState2.selectedValues;\n\n    var searchHeaders = {};\n    var suggestionsComponents = [_constants.componentTypes.dataSearch, _constants.componentTypes.categorySearch];\n    var isSuggestionsQuery = isInternalComponent && suggestionsComponents.indexOf(componentType) !== -1;\n\n    if (config.analytics) {\n      if (config.analyticsConfig.suggestionAnalytics && isSuggestionsQuery) {\n        var suggestionsSearchValue = analytics.suggestionsSearchValue;\n        var shouldIncludeQuery = !!(config.analyticsConfig.emptyQuery || suggestionsSearchValue);\n\n        if (shouldIncludeQuery) {\n          searchHeaders = {\n            'X-Search-Query': suggestionsSearchValue || ''\n          };\n        }\n      } else {\n        var searchValue = analytics.searchValue,\n            searchId = analytics.searchId;\n        var filterString = (0, _analytics2.default)(selectedValues);\n\n        if (searchId) {\n          searchHeaders = _extends({\n            'X-Search-Id': searchId,\n            'X-Search-Query': searchValue || ''\n          }, filterString && {\n            'X-Search-Filters': filterString\n          });\n        } else {\n          var _shouldIncludeQuery = !!(config.analyticsConfig.emptyQuery || searchValue);\n\n          searchHeaders = _extends(_shouldIncludeQuery && {\n            'X-Search-Query': searchValue || ''\n          }, filterString && {\n            'X-Search-Filters': filterString\n          });\n        }\n      }\n\n      if (config.analyticsConfig.searchStateHeader) {\n        var searchState = (0, _helper.getSearchState)(getState(), true);\n\n        if (searchState && Object.keys(searchState).length) {\n          searchHeaders['X-Search-State'] = JSON.stringify(searchState);\n        }\n      }\n\n      if (config.analyticsConfig.userId) {\n        searchHeaders['X-User-Id'] = config.analyticsConfig.userId;\n      }\n\n      if (config.analyticsConfig.customEvents) {\n        searchHeaders['X-Search-CustomEvent'] = (0, _analytics.parseCustomEvents)(config.analyticsConfig.customEvents);\n      }\n    }\n\n    orderOfQueries.forEach(function (component) {\n      dispatch((0, _misc.setLoading)(component, true));\n      dispatch((0, _misc.setError)(component, null));\n    });\n\n    if (config.graphQLUrl) {\n      (0, _graphQL2.default)(config.graphQLUrl, config.url, config.credentials, config.app, query).then(function (res) {\n        (0, _utils.handleResponseMSearch)({\n          res: res,\n          isSuggestionsQuery: isSuggestionsQuery,\n          orderOfQueries: orderOfQueries,\n          appendToHits: appendToHits,\n          appendToAggs: appendToAggs\n        }, getState, dispatch);\n      }).catch(function (err) {\n        (0, _utils.handleError)({\n          orderOfQueries: orderOfQueries,\n          error: err\n        }, getState, dispatch);\n      });\n    } else {\n      appbaseRef.setHeaders(_extends({}, headers, searchHeaders));\n      appbaseRef.msearch({\n        type: config.type === '*' ? '' : config.type,\n        body: query\n      }).then(function (res) {\n        (0, _utils.handleResponseMSearch)({\n          res: res,\n          isSuggestionsQuery: isSuggestionsQuery,\n          orderOfQueries: orderOfQueries,\n          appendToHits: appendToHits,\n          appendToAggs: appendToAggs\n        }, getState, dispatch);\n      }).catch(function (err) {\n        (0, _utils.handleError)({\n          orderOfQueries: orderOfQueries,\n          error: err\n        }, getState, dispatch);\n      });\n    }\n  };\n}\n\nfunction appbaseSearch() {\n  var _ref = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {},\n      query = _ref.query,\n      orderOfQueries = _ref.orderOfQueries,\n      _ref$appendToHits = _ref.appendToHits,\n      appendToHits = _ref$appendToHits === undefined ? false : _ref$appendToHits,\n      _ref$isInternalCompon = _ref.isInternalComponent,\n      isInternalComponent = _ref$isInternalCompon === undefined ? false : _ref$isInternalCompon,\n      _ref$appendToAggs = _ref.appendToAggs,\n      appendToAggs = _ref$appendToAggs === undefined ? false : _ref$appendToAggs,\n      componentType = _ref.componentType,\n      componentId = _ref.componentId;\n\n  return function (dispatch, getState) {\n    var _getState3 = getState(),\n        appbaseRef = _getState3.appbaseRef,\n        config = _getState3.config,\n        headers = _getState3.headers;\n\n    var isAnalyticsEnabled = false;\n\n    if (config) {\n      if ((0, _utils.isPropertyDefined)(config.analytics)) {\n        isAnalyticsEnabled = config.analytics;\n      } else if (config.analyticsConfig) {\n        if ((0, _utils.isPropertyDefined)(config.analyticsConfig.recordAnalytics)) {\n          isAnalyticsEnabled = config.analyticsConfig.recordAnalytics;\n        } else if ((0, _utils.isPropertyDefined)(config.analyticsConfig.analytics)) {\n          isAnalyticsEnabled = config.analyticsConfig.analytics;\n        }\n      }\n    }\n\n    var settings = {\n      recordAnalytics: isAnalyticsEnabled\n    };\n\n    if (config.analyticsConfig) {\n      settings.userId = (0, _utils.isPropertyDefined)(config.analyticsConfig.userId) ? config.analyticsConfig.userId : undefined;\n      settings.enableQueryRules = (0, _utils.isPropertyDefined)(config.analyticsConfig.enableQueryRules) ? config.analyticsConfig.enableQueryRules : undefined;\n      settings.customEvents = (0, _utils.isPropertyDefined)(config.analyticsConfig.customEvents) ? config.analyticsConfig.customEvents : undefined;\n    }\n\n    orderOfQueries.forEach(function (component) {\n      dispatch((0, _misc.setLoading)(component, true));\n      dispatch((0, _misc.setError)(component, null));\n    });\n    appbaseRef.setHeaders(_extends({}, headers));\n\n    if (isInternalComponent) {\n      dispatch(loadPopularSuggestions(componentId));\n    }\n\n    appbaseRef.reactiveSearchv3(query, settings).then(function (res) {\n      (0, _utils.handleResponse)({\n        res: res,\n        isInternalComponent: isInternalComponent,\n        orderOfQueries: orderOfQueries,\n        appendToHits: appendToHits,\n        appendToAggs: appendToAggs,\n        componentType: componentType,\n        componentId: componentId\n      }, getState, dispatch);\n    }).catch(function (err) {\n      (0, _utils.handleError)({\n        orderOfQueries: orderOfQueries,\n        error: err\n      }, getState, dispatch);\n    });\n  };\n}\n\nfunction executeQuery(componentId) {\n  var executeWatchList = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n  var mustExecuteMapQuery = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;\n  var componentType = arguments[3];\n  var metaOptions = arguments[4];\n  return function (dispatch, getState) {\n    var _getState4 = getState(),\n        queryLog = _getState4.queryLog,\n        stream = _getState4.stream,\n        appbaseRef = _getState4.appbaseRef,\n        config = _getState4.config,\n        mapData = _getState4.mapData,\n        watchMan = _getState4.watchMan,\n        dependencyTree = _getState4.dependencyTree,\n        queryList = _getState4.queryList,\n        queryOptions = _getState4.queryOptions,\n        queryListener = _getState4.queryListener,\n        props = _getState4.props;\n\n    var componentList = [componentId];\n    var finalQuery = [];\n    var appbaseQuery = {};\n    var orderOfQueries = [];\n    var isAppbaseEnabled = config && config.enableAppbase;\n\n    if (executeWatchList) {\n      var watchList = watchMan[componentId] || [];\n      componentList = [].concat(_toConsumableArray(componentList), _toConsumableArray(watchList));\n    }\n\n    var matchAllQuery = {\n      match_all: {}\n    };\n    componentList.forEach(function (component) {\n      var componentProps = props[component];\n\n      if (queryLog[component] && [_constants.componentTypes.reactiveList, _constants.componentTypes.reactiveMap].includes(componentProps.componentType)) {\n        dispatch((0, _value.setValue)(component, null));\n      }\n\n      var _buildQuery = (0, _helper.buildQuery)(component, dependencyTree, queryList, queryOptions),\n          queryObj = _buildQuery.queryObj,\n          options = _buildQuery.options;\n\n      var validOptions = ['aggs', 'from', 'sort'];\n\n      if (queryObj && !!Object.keys(queryObj).length || options && Object.keys(options).some(function (item) {\n        return validOptions.includes(item);\n      })) {\n        if (!queryObj || queryObj && !Object.keys(queryObj).length) {\n          queryObj = _extends({}, matchAllQuery);\n        }\n\n        var currentQuery = _extends({\n          query: _extends({}, queryObj)\n        }, options, queryOptions[component]);\n\n        var queryToLog = _extends({\n          query: _extends({}, queryObj)\n        }, options, queryOptions[component]);\n\n        var oldQuery = queryLog[component];\n\n        if (mustExecuteMapQuery || !(0, _helper.isEqual)(currentQuery, oldQuery)) {\n          orderOfQueries = [].concat(_toConsumableArray(orderOfQueries), [component]);\n          dispatch((0, _misc.logQuery)(component, queryToLog));\n          var isMapComponent = Object.keys(mapData).includes(component);\n\n          if (isMapComponent && mapData[component].query) {\n            var existingQuery = currentQuery.query;\n            currentQuery.query = {\n              bool: {\n                must: [existingQuery, mapData[component].query]\n              }\n            };\n\n            if (!mapData[component].persistMapQuery) {\n              dispatch((0, _maps.updateMapData)(componentId, null, false));\n            }\n\n            var _getState5 = getState(),\n                combinedLog = _getState5.combinedLog;\n\n            if ((0, _helper.isEqual)(combinedLog[component], currentQuery)) return;\n            dispatch((0, _misc.logCombinedQuery)(component, currentQuery));\n          }\n\n          (0, _utils.executeQueryListener)(queryListener[component], oldQuery, currentQuery);\n\n          if (stream[component] && stream[component].status) {\n            if (stream[component].ref) {\n              stream[component].ref.stop();\n            }\n\n            var ref = appbaseRef.searchStream({\n              type: config.type === '*' ? '' : config.type,\n              body: currentQuery\n            }, function (response) {\n              if (response._id) {\n                dispatch((0, _hits.pushToStreamHits)(component, response));\n              }\n            }, function (error) {\n              if (queryListener[component] && queryListener[component].onError) {\n                queryListener[component].onError(error);\n              }\n\n              console.warn(error);\n              dispatch((0, _misc.setError)(component, error));\n              dispatch((0, _misc.setLoading)(component, false));\n            });\n            dispatch((0, _misc.setStreaming)(component, true, ref));\n          }\n\n          if (isAppbaseEnabled) {\n            var query = (0, _transform.getRSQuery)(component, (0, _transform.extractPropsFromState)(getState(), component, metaOptions ? {\n              from: metaOptions.from\n            } : null));\n\n            if (query) {\n              appbaseQuery = _extends({}, appbaseQuery, _defineProperty({}, component, query), (0, _transform.getDependentQueries)(getState(), component, orderOfQueries));\n            }\n\n            if (isMapComponent) {\n              var internalComponent = (0, _transform2.getInternalComponentID)(component);\n              var internalQuery = (0, _transform.getRSQuery)(internalComponent, (0, _transform.extractPropsFromState)(getState(), internalComponent, metaOptions ? {\n                from: metaOptions.from\n              } : null));\n\n              if (internalQuery) {\n                appbaseQuery[internalComponent] = _extends({}, internalQuery, {\n                  execute: false\n                });\n              }\n            }\n          } else {\n            finalQuery = [].concat(_toConsumableArray(finalQuery), [{\n              preference: component\n            }, currentQuery]);\n          }\n        }\n      }\n    });\n\n    if (isAppbaseEnabled) {\n      finalQuery = Object.keys(appbaseQuery).map(function (component) {\n        return appbaseQuery[component];\n      });\n    }\n\n    if (finalQuery.length) {\n      if (isAppbaseEnabled) {\n        dispatch(appbaseSearch({\n          query: finalQuery,\n          orderOfQueries: orderOfQueries,\n          isInternalComponent: componentId.endsWith('__internal'),\n          componentType: componentType,\n          props: props[componentId],\n          componentId: componentId\n        }));\n      } else {\n        dispatch(msearch(finalQuery, orderOfQueries, false, componentId.endsWith('__internal'), undefined, componentType));\n      }\n    }\n  };\n}\n\nfunction setQueryOptions(component, queryOptions) {\n  var execute = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : true;\n  return function (dispatch) {\n    dispatch((0, _misc.updateQueryOptions)(component, queryOptions));\n\n    if (execute) {\n      dispatch(executeQuery(component, true));\n    }\n  };\n}\n\nfunction updateQuery(_ref2) {\n  var componentId = _ref2.componentId,\n      query = _ref2.query,\n      value = _ref2.value,\n      _ref2$label = _ref2.label,\n      label = _ref2$label === undefined ? null : _ref2$label,\n      _ref2$showFilter = _ref2.showFilter,\n      showFilter = _ref2$showFilter === undefined ? true : _ref2$showFilter,\n      _ref2$URLParams = _ref2.URLParams,\n      URLParams = _ref2$URLParams === undefined ? false : _ref2$URLParams,\n      _ref2$componentType = _ref2.componentType,\n      componentType = _ref2$componentType === undefined ? null : _ref2$componentType,\n      _ref2$category = _ref2.category,\n      category = _ref2$category === undefined ? null : _ref2$category,\n      _ref2$meta = _ref2.meta,\n      meta = _ref2$meta === undefined ? {} : _ref2$meta;\n  var execute = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : true;\n  return function (dispatch) {\n    var queryToDispatch = query;\n\n    if (query && query.query) {\n      queryToDispatch = query.query;\n    }\n\n    if (!componentId.endsWith('__internal')) {\n      dispatch((0, _value.setValue)(componentId, value, label, showFilter, URLParams, componentType, category, meta));\n\n      if (componentType === _constants.componentTypes.dynamicRangeSlider) {\n        dispatch((0, _value.setInternalValue)((0, _transform.getHistogramComponentID)(componentId), value, componentType, category, meta));\n      } else {\n        dispatch((0, _value.setInternalValue)(componentId + '__internal', value, componentType, category, meta));\n      }\n    } else {\n      dispatch((0, _value.setInternalValue)(componentId, value, componentType, category, meta));\n    }\n\n    dispatch((0, _misc.setQuery)(componentId, queryToDispatch));\n    if (execute) dispatch(executeQuery(componentId, true, false, componentType));\n  };\n}\n\nfunction loadMore(component, newOptions) {\n  var appendToHits = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : true;\n  var appendToAggs = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : false;\n  return function (dispatch, getState) {\n    var store = getState();\n\n    var _buildQuery2 = (0, _helper.buildQuery)(component, store.dependencyTree, store.queryList, store.queryOptions),\n        queryObj = _buildQuery2.queryObj,\n        options = _buildQuery2.options;\n\n    var queryLog = store.queryLog;\n    if (!options) options = {};\n    options = _extends({}, options, newOptions);\n\n    if (!queryObj || queryObj && !Object.keys(queryObj).length) {\n      queryObj = {\n        match_all: {}\n      };\n    }\n\n    var currentQuery = _extends({\n      query: _extends({}, queryObj)\n    }, options);\n\n    if ((0, _helper.isEqual)(queryLog[component], currentQuery)) return;\n    dispatch((0, _misc.logQuery)(component, currentQuery));\n\n    if (store.config && store.config.enableAppbase) {\n      var appbaseQuery = {};\n      var componentProps = store.props[component] || {};\n      var compositeAggregationField = componentProps.aggregationField;\n      var queryType = _transform.componentToTypeMap[componentProps.componentType];\n\n      if (queryType === _constants.queryTypes.term) {\n        compositeAggregationField = componentProps.dataField;\n      }\n\n      var query = (0, _transform.getRSQuery)(component, (0, _transform.extractPropsFromState)(store, component, {\n        from: options.from,\n        after: store.aggregations[component] && store.aggregations[component][compositeAggregationField] && store.aggregations[component][compositeAggregationField].after_key || undefined\n      }));\n      appbaseQuery = _extends(_defineProperty({}, component, query), (0, _transform.getDependentQueries)(getState(), component, []));\n      var finalQuery = Object.keys(appbaseQuery).map(function (c) {\n        return appbaseQuery[c];\n      });\n      dispatch(appbaseSearch({\n        query: finalQuery,\n        orderOfQueries: [component],\n        appendToHits: appendToHits,\n        appendToAggs: appendToAggs\n      }));\n    } else {\n      var _finalQuery = [{\n        preference: component\n      }, currentQuery];\n      dispatch(msearch(_finalQuery, [component], appendToHits, false, appendToAggs));\n    }\n  };\n}","map":{"version":3,"sources":["C:/Users/hiro/react_project/react_search/react_search/frontend/node_modules/@appbaseio/reactivecore/lib/actions/query.js"],"names":["Object","defineProperty","exports","value","_extends","assign","target","i","arguments","length","source","key","prototype","hasOwnProperty","call","loadPopularSuggestions","executeQuery","setQueryOptions","updateQuery","loadMore","_value","require","_utils","_hits","_misc","_helper","_analytics","_analytics2","_interopRequireDefault","_maps","_graphQL","_graphQL2","_constants","_transform","_transform2","obj","__esModule","default","_defineProperty","enumerable","configurable","writable","_toConsumableArray","arr","Array","isArray","arr2","from","componentId","dispatch","getState","_getState","config","appbaseRef","props","internalValues","isAppbaseEnabled","enableAppbase","componentProps","internalValue","enablePopularSuggestions","enableQuerySuggestions","suggQuery","getSuggestionQuery","getQuerySuggestions","then","suggestions","querySuggestion","getQuerySuggestionsId","setPopularSuggestions","hits","split","setDefaultPopularSuggestions","catch","e","handleError","orderOfQueries","error","msearch","query","appendToHits","undefined","isInternalComponent","appendToAggs","componentType","_getState2","headers","analytics","selectedValues","searchHeaders","suggestionsComponents","componentTypes","dataSearch","categorySearch","isSuggestionsQuery","indexOf","analyticsConfig","suggestionAnalytics","suggestionsSearchValue","shouldIncludeQuery","emptyQuery","searchValue","searchId","filterString","_shouldIncludeQuery","searchStateHeader","searchState","getSearchState","keys","JSON","stringify","userId","customEvents","parseCustomEvents","forEach","component","setLoading","setError","graphQLUrl","url","credentials","app","res","handleResponseMSearch","err","setHeaders","type","body","appbaseSearch","_ref","_ref$appendToHits","_ref$isInternalCompon","_ref$appendToAggs","_getState3","isAnalyticsEnabled","isPropertyDefined","recordAnalytics","settings","enableQueryRules","reactiveSearchv3","handleResponse","executeWatchList","mustExecuteMapQuery","metaOptions","_getState4","queryLog","stream","mapData","watchMan","dependencyTree","queryList","queryOptions","queryListener","componentList","finalQuery","appbaseQuery","watchList","concat","matchAllQuery","match_all","reactiveList","reactiveMap","includes","setValue","_buildQuery","buildQuery","queryObj","options","validOptions","some","item","currentQuery","queryToLog","oldQuery","isEqual","logQuery","isMapComponent","existingQuery","bool","must","persistMapQuery","updateMapData","_getState5","combinedLog","logCombinedQuery","executeQueryListener","status","ref","stop","searchStream","response","_id","pushToStreamHits","onError","console","warn","setStreaming","getRSQuery","extractPropsFromState","getDependentQueries","internalComponent","getInternalComponentID","internalQuery","execute","preference","map","endsWith","updateQueryOptions","_ref2","_ref2$label","label","_ref2$showFilter","showFilter","_ref2$URLParams","URLParams","_ref2$componentType","_ref2$category","category","_ref2$meta","meta","queryToDispatch","dynamicRangeSlider","setInternalValue","getHistogramComponentID","setQuery","newOptions","store","_buildQuery2","compositeAggregationField","aggregationField","queryType","componentToTypeMap","queryTypes","term","dataField","after","aggregations","after_key","c","_finalQuery"],"mappings":"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","sourcesContent":["Object.defineProperty(exports,\"__esModule\",{value:true});var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key];}}}return target;};exports.loadPopularSuggestions=loadPopularSuggestions;exports.executeQuery=executeQuery;exports.setQueryOptions=setQueryOptions;exports.updateQuery=updateQuery;exports.loadMore=loadMore;var _value=require('./value');var _utils=require('./utils');var _hits=require('./hits');var _misc=require('./misc');var _helper=require('../utils/helper');var _analytics=require('../utils/analytics');var _analytics2=_interopRequireDefault(_analytics);var _maps=require('./maps');var _graphQL=require('../utils/graphQL');var _graphQL2=_interopRequireDefault(_graphQL);var _constants=require('../utils/constants');var _transform=require('../utils/transform');var _transform2=require('../../lib/utils/transform');function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true});}else{obj[key]=value;}return obj;}function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++){arr2[i]=arr[i];}return arr2;}else{return Array.from(arr);}}function loadPopularSuggestions(componentId){return function(dispatch,getState){var _getState=getState(),config=_getState.config,appbaseRef=_getState.appbaseRef,props=_getState.props,internalValues=_getState.internalValues;var isAppbaseEnabled=config&&config.enableAppbase;var componentProps=props[componentId]||{};var internalValue=internalValues[componentId];var value=internalValue&&internalValue.value||'';if(isAppbaseEnabled&&(componentProps.enablePopularSuggestions||componentProps.enableQuerySuggestions)){var suggQuery=(0,_utils.getSuggestionQuery)(getState,componentId);appbaseRef.getQuerySuggestions(suggQuery).then(function(suggestions){var querySuggestion=suggestions[(0,_utils.getQuerySuggestionsId)(componentId)];if(value){dispatch((0,_misc.setPopularSuggestions)(querySuggestion&&querySuggestion.hits&&querySuggestion.hits.hits,componentId.split('__internal')[0]));}else{dispatch((0,_misc.setDefaultPopularSuggestions)(querySuggestion&&querySuggestion.hits&&querySuggestion.hits.hits,componentId.split('__internal')[0]));}}).catch(function(e){(0,_utils.handleError)({orderOfQueries:[componentId],error:e},getState,dispatch);});}};}function msearch(query,orderOfQueries){var appendToHits=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;var isInternalComponent=arguments.length>3&&arguments[3]!==undefined?arguments[3]:false;var appendToAggs=arguments.length>4&&arguments[4]!==undefined?arguments[4]:false;var componentType=arguments[5];return function(dispatch,getState){var _getState2=getState(),appbaseRef=_getState2.appbaseRef,config=_getState2.config,headers=_getState2.headers,analytics=_getState2.analytics,selectedValues=_getState2.selectedValues;var searchHeaders={};var suggestionsComponents=[_constants.componentTypes.dataSearch,_constants.componentTypes.categorySearch];var isSuggestionsQuery=isInternalComponent&&suggestionsComponents.indexOf(componentType)!==-1;if(config.analytics){if(config.analyticsConfig.suggestionAnalytics&&isSuggestionsQuery){var suggestionsSearchValue=analytics.suggestionsSearchValue;var shouldIncludeQuery=!!(config.analyticsConfig.emptyQuery||suggestionsSearchValue);if(shouldIncludeQuery){searchHeaders={'X-Search-Query':suggestionsSearchValue||''};}}else{var searchValue=analytics.searchValue,searchId=analytics.searchId;var filterString=(0,_analytics2.default)(selectedValues);if(searchId){searchHeaders=_extends({'X-Search-Id':searchId,'X-Search-Query':searchValue||''},filterString&&{'X-Search-Filters':filterString});}else{var _shouldIncludeQuery=!!(config.analyticsConfig.emptyQuery||searchValue);searchHeaders=_extends(_shouldIncludeQuery&&{'X-Search-Query':searchValue||''},filterString&&{'X-Search-Filters':filterString});}}if(config.analyticsConfig.searchStateHeader){var searchState=(0,_helper.getSearchState)(getState(),true);if(searchState&&Object.keys(searchState).length){searchHeaders['X-Search-State']=JSON.stringify(searchState);}}if(config.analyticsConfig.userId){searchHeaders['X-User-Id']=config.analyticsConfig.userId;}if(config.analyticsConfig.customEvents){searchHeaders['X-Search-CustomEvent']=(0,_analytics.parseCustomEvents)(config.analyticsConfig.customEvents);}}orderOfQueries.forEach(function(component){dispatch((0,_misc.setLoading)(component,true));dispatch((0,_misc.setError)(component,null));});if(config.graphQLUrl){(0,_graphQL2.default)(config.graphQLUrl,config.url,config.credentials,config.app,query).then(function(res){(0,_utils.handleResponseMSearch)({res:res,isSuggestionsQuery:isSuggestionsQuery,orderOfQueries:orderOfQueries,appendToHits:appendToHits,appendToAggs:appendToAggs},getState,dispatch);}).catch(function(err){(0,_utils.handleError)({orderOfQueries:orderOfQueries,error:err},getState,dispatch);});}else{appbaseRef.setHeaders(_extends({},headers,searchHeaders));appbaseRef.msearch({type:config.type==='*'?'':config.type,body:query}).then(function(res){(0,_utils.handleResponseMSearch)({res:res,isSuggestionsQuery:isSuggestionsQuery,orderOfQueries:orderOfQueries,appendToHits:appendToHits,appendToAggs:appendToAggs},getState,dispatch);}).catch(function(err){(0,_utils.handleError)({orderOfQueries:orderOfQueries,error:err},getState,dispatch);});}};}function appbaseSearch(){var _ref=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},query=_ref.query,orderOfQueries=_ref.orderOfQueries,_ref$appendToHits=_ref.appendToHits,appendToHits=_ref$appendToHits===undefined?false:_ref$appendToHits,_ref$isInternalCompon=_ref.isInternalComponent,isInternalComponent=_ref$isInternalCompon===undefined?false:_ref$isInternalCompon,_ref$appendToAggs=_ref.appendToAggs,appendToAggs=_ref$appendToAggs===undefined?false:_ref$appendToAggs,componentType=_ref.componentType,componentId=_ref.componentId;return function(dispatch,getState){var _getState3=getState(),appbaseRef=_getState3.appbaseRef,config=_getState3.config,headers=_getState3.headers;var isAnalyticsEnabled=false;if(config){if((0,_utils.isPropertyDefined)(config.analytics)){isAnalyticsEnabled=config.analytics;}else if(config.analyticsConfig){if((0,_utils.isPropertyDefined)(config.analyticsConfig.recordAnalytics)){isAnalyticsEnabled=config.analyticsConfig.recordAnalytics;}else if((0,_utils.isPropertyDefined)(config.analyticsConfig.analytics)){isAnalyticsEnabled=config.analyticsConfig.analytics;}}}var settings={recordAnalytics:isAnalyticsEnabled};if(config.analyticsConfig){settings.userId=(0,_utils.isPropertyDefined)(config.analyticsConfig.userId)?config.analyticsConfig.userId:undefined;settings.enableQueryRules=(0,_utils.isPropertyDefined)(config.analyticsConfig.enableQueryRules)?config.analyticsConfig.enableQueryRules:undefined;settings.customEvents=(0,_utils.isPropertyDefined)(config.analyticsConfig.customEvents)?config.analyticsConfig.customEvents:undefined;}orderOfQueries.forEach(function(component){dispatch((0,_misc.setLoading)(component,true));dispatch((0,_misc.setError)(component,null));});appbaseRef.setHeaders(_extends({},headers));if(isInternalComponent){dispatch(loadPopularSuggestions(componentId));}appbaseRef.reactiveSearchv3(query,settings).then(function(res){(0,_utils.handleResponse)({res:res,isInternalComponent:isInternalComponent,orderOfQueries:orderOfQueries,appendToHits:appendToHits,appendToAggs:appendToAggs,componentType:componentType,componentId:componentId},getState,dispatch);}).catch(function(err){(0,_utils.handleError)({orderOfQueries:orderOfQueries,error:err},getState,dispatch);});};}function executeQuery(componentId){var executeWatchList=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;var mustExecuteMapQuery=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;var componentType=arguments[3];var metaOptions=arguments[4];return function(dispatch,getState){var _getState4=getState(),queryLog=_getState4.queryLog,stream=_getState4.stream,appbaseRef=_getState4.appbaseRef,config=_getState4.config,mapData=_getState4.mapData,watchMan=_getState4.watchMan,dependencyTree=_getState4.dependencyTree,queryList=_getState4.queryList,queryOptions=_getState4.queryOptions,queryListener=_getState4.queryListener,props=_getState4.props;var componentList=[componentId];var finalQuery=[];var appbaseQuery={};var orderOfQueries=[];var isAppbaseEnabled=config&&config.enableAppbase;if(executeWatchList){var watchList=watchMan[componentId]||[];componentList=[].concat(_toConsumableArray(componentList),_toConsumableArray(watchList));}var matchAllQuery={match_all:{}};componentList.forEach(function(component){var componentProps=props[component];if(queryLog[component]&&[_constants.componentTypes.reactiveList,_constants.componentTypes.reactiveMap].includes(componentProps.componentType)){dispatch((0,_value.setValue)(component,null));}var _buildQuery=(0,_helper.buildQuery)(component,dependencyTree,queryList,queryOptions),queryObj=_buildQuery.queryObj,options=_buildQuery.options;var validOptions=['aggs','from','sort'];if(queryObj&&!!Object.keys(queryObj).length||options&&Object.keys(options).some(function(item){return validOptions.includes(item);})){if(!queryObj||queryObj&&!Object.keys(queryObj).length){queryObj=_extends({},matchAllQuery);}var currentQuery=_extends({query:_extends({},queryObj)},options,queryOptions[component]);var queryToLog=_extends({query:_extends({},queryObj)},options,queryOptions[component]);var oldQuery=queryLog[component];if(mustExecuteMapQuery||!(0,_helper.isEqual)(currentQuery,oldQuery)){orderOfQueries=[].concat(_toConsumableArray(orderOfQueries),[component]);dispatch((0,_misc.logQuery)(component,queryToLog));var isMapComponent=Object.keys(mapData).includes(component);if(isMapComponent&&mapData[component].query){var existingQuery=currentQuery.query;currentQuery.query={bool:{must:[existingQuery,mapData[component].query]}};if(!mapData[component].persistMapQuery){dispatch((0,_maps.updateMapData)(componentId,null,false));}var _getState5=getState(),combinedLog=_getState5.combinedLog;if((0,_helper.isEqual)(combinedLog[component],currentQuery))return;dispatch((0,_misc.logCombinedQuery)(component,currentQuery));}(0,_utils.executeQueryListener)(queryListener[component],oldQuery,currentQuery);if(stream[component]&&stream[component].status){if(stream[component].ref){stream[component].ref.stop();}var ref=appbaseRef.searchStream({type:config.type==='*'?'':config.type,body:currentQuery},function(response){if(response._id){dispatch((0,_hits.pushToStreamHits)(component,response));}},function(error){if(queryListener[component]&&queryListener[component].onError){queryListener[component].onError(error);}console.warn(error);dispatch((0,_misc.setError)(component,error));dispatch((0,_misc.setLoading)(component,false));});dispatch((0,_misc.setStreaming)(component,true,ref));}if(isAppbaseEnabled){var query=(0,_transform.getRSQuery)(component,(0,_transform.extractPropsFromState)(getState(),component,metaOptions?{from:metaOptions.from}:null));if(query){appbaseQuery=_extends({},appbaseQuery,_defineProperty({},component,query),(0,_transform.getDependentQueries)(getState(),component,orderOfQueries));}if(isMapComponent){var internalComponent=(0,_transform2.getInternalComponentID)(component);var internalQuery=(0,_transform.getRSQuery)(internalComponent,(0,_transform.extractPropsFromState)(getState(),internalComponent,metaOptions?{from:metaOptions.from}:null));if(internalQuery){appbaseQuery[internalComponent]=_extends({},internalQuery,{execute:false});}}}else{finalQuery=[].concat(_toConsumableArray(finalQuery),[{preference:component},currentQuery]);}}}});if(isAppbaseEnabled){finalQuery=Object.keys(appbaseQuery).map(function(component){return appbaseQuery[component];});}if(finalQuery.length){if(isAppbaseEnabled){dispatch(appbaseSearch({query:finalQuery,orderOfQueries:orderOfQueries,isInternalComponent:componentId.endsWith('__internal'),componentType:componentType,props:props[componentId],componentId:componentId}));}else{dispatch(msearch(finalQuery,orderOfQueries,false,componentId.endsWith('__internal'),undefined,componentType));}}};}function setQueryOptions(component,queryOptions){var execute=arguments.length>2&&arguments[2]!==undefined?arguments[2]:true;return function(dispatch){dispatch((0,_misc.updateQueryOptions)(component,queryOptions));if(execute){dispatch(executeQuery(component,true));}};}function updateQuery(_ref2){var componentId=_ref2.componentId,query=_ref2.query,value=_ref2.value,_ref2$label=_ref2.label,label=_ref2$label===undefined?null:_ref2$label,_ref2$showFilter=_ref2.showFilter,showFilter=_ref2$showFilter===undefined?true:_ref2$showFilter,_ref2$URLParams=_ref2.URLParams,URLParams=_ref2$URLParams===undefined?false:_ref2$URLParams,_ref2$componentType=_ref2.componentType,componentType=_ref2$componentType===undefined?null:_ref2$componentType,_ref2$category=_ref2.category,category=_ref2$category===undefined?null:_ref2$category,_ref2$meta=_ref2.meta,meta=_ref2$meta===undefined?{}:_ref2$meta;var execute=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;return function(dispatch){var queryToDispatch=query;if(query&&query.query){queryToDispatch=query.query;}if(!componentId.endsWith('__internal')){dispatch((0,_value.setValue)(componentId,value,label,showFilter,URLParams,componentType,category,meta));if(componentType===_constants.componentTypes.dynamicRangeSlider){dispatch((0,_value.setInternalValue)((0,_transform.getHistogramComponentID)(componentId),value,componentType,category,meta));}else{dispatch((0,_value.setInternalValue)(componentId+'__internal',value,componentType,category,meta));}}else{dispatch((0,_value.setInternalValue)(componentId,value,componentType,category,meta));}dispatch((0,_misc.setQuery)(componentId,queryToDispatch));if(execute)dispatch(executeQuery(componentId,true,false,componentType));};}function loadMore(component,newOptions){var appendToHits=arguments.length>2&&arguments[2]!==undefined?arguments[2]:true;var appendToAggs=arguments.length>3&&arguments[3]!==undefined?arguments[3]:false;return function(dispatch,getState){var store=getState();var _buildQuery2=(0,_helper.buildQuery)(component,store.dependencyTree,store.queryList,store.queryOptions),queryObj=_buildQuery2.queryObj,options=_buildQuery2.options;var queryLog=store.queryLog;if(!options)options={};options=_extends({},options,newOptions);if(!queryObj||queryObj&&!Object.keys(queryObj).length){queryObj={match_all:{}};}var currentQuery=_extends({query:_extends({},queryObj)},options);if((0,_helper.isEqual)(queryLog[component],currentQuery))return;dispatch((0,_misc.logQuery)(component,currentQuery));if(store.config&&store.config.enableAppbase){var appbaseQuery={};var componentProps=store.props[component]||{};var compositeAggregationField=componentProps.aggregationField;var queryType=_transform.componentToTypeMap[componentProps.componentType];if(queryType===_constants.queryTypes.term){compositeAggregationField=componentProps.dataField;}var query=(0,_transform.getRSQuery)(component,(0,_transform.extractPropsFromState)(store,component,{from:options.from,after:store.aggregations[component]&&store.aggregations[component][compositeAggregationField]&&store.aggregations[component][compositeAggregationField].after_key||undefined}));appbaseQuery=_extends(_defineProperty({},component,query),(0,_transform.getDependentQueries)(getState(),component,[]));var finalQuery=Object.keys(appbaseQuery).map(function(c){return appbaseQuery[c];});dispatch(appbaseSearch({query:finalQuery,orderOfQueries:[component],appendToHits:appendToHits,appendToAggs:appendToAggs}));}else{var _finalQuery=[{preference:component},currentQuery];dispatch(msearch(_finalQuery,[component],appendToHits,false,appendToAggs));}};}"]},"metadata":{},"sourceType":"script"}