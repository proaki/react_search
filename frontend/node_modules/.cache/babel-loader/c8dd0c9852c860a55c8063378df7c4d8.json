{"ast":null,"code":"'use strict';\n\nexports.__esModule = true;\n\nvar _extends = Object.assign || function (target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i];\n\n    for (var key in source) {\n      if (Object.prototype.hasOwnProperty.call(source, key)) {\n        target[key] = source[key];\n      }\n    }\n  }\n\n  return target;\n};\n\nvar _createClass = function () {\n  function defineProperties(target, props) {\n    for (var i = 0; i < props.length; i++) {\n      var descriptor = props[i];\n      descriptor.enumerable = descriptor.enumerable || false;\n      descriptor.configurable = true;\n      if (\"value\" in descriptor) descriptor.writable = true;\n      Object.defineProperty(target, descriptor.key, descriptor);\n    }\n  }\n\n  return function (Constructor, protoProps, staticProps) {\n    if (protoProps) defineProperties(Constructor.prototype, protoProps);\n    if (staticProps) defineProperties(Constructor, staticProps);\n    return Constructor;\n  };\n}();\n\nvar _react = require('react');\n\nvar _react2 = _interopRequireDefault(_react);\n\nvar _propTypes = require('prop-types');\n\nvar _types = require('@appbaseio/reactivecore/lib/utils/types');\n\nvar _types2 = _interopRequireDefault(_types);\n\nvar _helper = require('@appbaseio/reactivecore/lib/utils/helper');\n\nvar _actions = require('@appbaseio/reactivecore/lib/actions');\n\nvar _utils = require('../../../utils');\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nfunction _possibleConstructorReturn(self, call) {\n  if (!self) {\n    throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n  }\n\n  return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self;\n}\n\nfunction _inherits(subClass, superClass) {\n  if (typeof superClass !== \"function\" && superClass !== null) {\n    throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass);\n  }\n\n  subClass.prototype = Object.create(superClass && superClass.prototype, {\n    constructor: {\n      value: subClass,\n      enumerable: false,\n      writable: true,\n      configurable: true\n    }\n  });\n  if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass;\n}\n\nvar debounce = function debounce(method, delay) {\n  clearTimeout(method._tId); // eslint-disable-next-line\n\n  method._tId = setTimeout(function () {\n    method();\n  }, delay);\n};\n\nvar ImpressionTracker = function (_React$Component) {\n  _inherits(ImpressionTracker, _React$Component);\n\n  function ImpressionTracker() {\n    var _temp, _this, _ret;\n\n    _classCallCheck(this, ImpressionTracker);\n\n    for (var _len = arguments.length, args = Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    return _ret = (_temp = (_this = _possibleConstructorReturn(this, _React$Component.call.apply(_React$Component, [this].concat(args))), _this), _this.currentHits = [], _this.trackedIds = {}, _this.waitingToBeTracked = {}, _this.setTrackerInterval = function () {\n      _this.intervalID = setInterval(_this.tracker, 1000);\n    }, _this.clearTrackerInterval = function () {\n      if (_this.intervalID) {\n        clearInterval(_this.intervalID); // Reset interval ID\n\n        _this.intervalID = null;\n      }\n    }, _this.tracker = function () {\n      if (!_this.hitIds.length) {\n        _this.clearTrackerInterval();\n\n        return;\n      } // only run at client-side\n\n\n      if (window && document) {\n        _this.hitIds.forEach(function (id) {\n          var element = document.getElementById(id);\n\n          if (element) {\n            if (_this.inViewPort(element)) {\n              // Add the hit id in the list of tracked ids\n              var hitObject = _this.currentHits.find(function (hit) {\n                return hit._id === id;\n              });\n\n              _this.trackedIds[id] = true; // Add hit to waiting list to be recorded\n\n              _this.addToWaitingList(hitObject);\n            }\n          }\n        });\n      }\n\n      debounce(_this.recordImpression, 300);\n    }, _this.addToWaitingList = function (hitObject) {\n      var queryId = _this.queryId;\n\n      if (hitObject && queryId) {\n        var impression = {\n          id: hitObject._id,\n          index: hitObject._index\n        }; // Check if query id already present in waiting list\n\n        if (_this.waitingToBeTracked[queryId]) {\n          _this.waitingToBeTracked[queryId].push(impression);\n        } else {\n          _this.waitingToBeTracked[queryId] = [impression];\n        }\n      }\n    }, _this.recordImpression = function () {\n      if (Object.keys(_this.waitingToBeTracked).length) {\n        var trackImpressions = _this.props.trackImpressions;\n\n        var untrackedHits = _extends({}, _this.waitingToBeTracked);\n\n        Object.keys(untrackedHits).forEach(function (queryId) {\n          if (untrackedHits[queryId] && untrackedHits[queryId].length) {\n            trackImpressions(queryId, untrackedHits[queryId]); // Removed tracked impressions from waiting list\n\n            delete _this.waitingToBeTracked[queryId];\n          }\n        });\n      }\n    }, _temp), _possibleConstructorReturn(_this, _ret);\n  } // Represents the list of hits returned by the query\n  // An array of hits objects\n  // An object to track the recorded impressions\n  // It can have the values in following shape\n  // { \"hit_id\": { \"index\": \"test\" }}\n  // An object to know the the untracked impression i.e not recorded by BE\n  // It can have the values in following shape\n  // { \"query_id\": [{ \"id\": \"hit_id\", \"index\": \"test\"}]}\n\n\n  ImpressionTracker.prototype.componentDidMount = function componentDidMount() {\n    var hits = this.props.hits;\n    this.setCurrentHits(hits); // Add scroll events to track the impressions\n\n    if (window) {\n      window.addEventListener('scroll', this.tracker);\n    }\n  };\n\n  ImpressionTracker.prototype.componentDidUpdate = function componentDidUpdate(prevProps) {\n    var hits = this.props.hits;\n\n    if (hits && hits !== prevProps.hits) {\n      // Only compare hit ids for performance reasons\n      var prevHitIds = prevProps.hits.map(function (hit) {\n        return hit._id;\n      });\n      var currentHitIds = hits.map(function (hit) {\n        return hit._id;\n      });\n\n      if (!(0, _helper.isEqual)(currentHitIds, prevHitIds)) {\n        this.setCurrentHits(hits);\n      }\n    }\n  };\n\n  ImpressionTracker.prototype.componentWillUnmount = function componentWillUnmount() {\n    // Clear the interval\n    this.clearTrackerInterval();\n  };\n\n  ImpressionTracker.prototype.inViewPort = function inViewPort(el) {\n    var rect = el.getBoundingClientRect();\n    return rect.top >= 0 && rect.left >= 0 && rect.bottom <= (window.innerHeight || document.documentElement.clientHeight) && rect.right <= (window.innerWidth || document.documentElement.clientWidth);\n  };\n\n  ImpressionTracker.prototype.setCurrentHits = function setCurrentHits(hits) {\n    this.currentHits = hits; // Reset the tracked Ids for new hits\n\n    this.trackedIds = {};\n\n    if (hits.length) {\n      this.tracker(); // Run the tracker function on an interval of 1s to track the impressions for\n      // non-scroll views for e.g on tab change\n\n      this.setTrackerInterval();\n    }\n  };\n\n  ImpressionTracker.prototype.render = function render() {\n    var children = this.props.children;\n    return children;\n  };\n\n  _createClass(ImpressionTracker, [{\n    key: 'hitIds',\n    get: function get() {\n      var _this2 = this;\n\n      return this.currentHits.map(function (hit) {\n        return hit._id;\n      }).filter(function (id) {\n        return !_this2.trackedIds[id];\n      });\n    }\n  }, {\n    key: 'queryId',\n    get: function get() {\n      var state = this.context && this.context.store ? this.context.store.getState() : null;\n      return state ? state.analytics.searchId : null;\n    }\n  }]);\n\n  return ImpressionTracker;\n}(_react2.default.Component);\n\nImpressionTracker.contextType = _utils.ReactReduxContext;\nImpressionTracker.propTypes = {\n  trackImpressions: _types2.default.funcRequired,\n  hits: _types2.default.hits,\n  children: _propTypes.node\n};\n\nvar mapDispatchToProps = function mapDispatchToProps(dispatch) {\n  return {\n    trackImpressions: function trackImpressions(queryID, impressions) {\n      return dispatch((0, _actions.recordImpressions)(queryID, impressions));\n    }\n  };\n};\n\nexports.default = (0, _utils.connect)(null, mapDispatchToProps)(ImpressionTracker);","map":{"version":3,"sources":["C:/Users/hiro/react_project/react_search/react_search/frontend/node_modules/@appbaseio/reactivesearch/lib/components/result/addons/ImpressionTracker.js"],"names":["exports","__esModule","_extends","Object","assign","target","i","arguments","length","source","key","prototype","hasOwnProperty","call","_createClass","defineProperties","props","descriptor","enumerable","configurable","writable","defineProperty","Constructor","protoProps","staticProps","_react","require","_react2","_interopRequireDefault","_propTypes","_types","_types2","_helper","_actions","_utils","obj","default","_classCallCheck","instance","TypeError","_possibleConstructorReturn","self","ReferenceError","_inherits","subClass","superClass","create","constructor","value","setPrototypeOf","__proto__","debounce","method","delay","clearTimeout","_tId","setTimeout","ImpressionTracker","_React$Component","_temp","_this","_ret","_len","args","Array","_key","apply","concat","currentHits","trackedIds","waitingToBeTracked","setTrackerInterval","intervalID","setInterval","tracker","clearTrackerInterval","clearInterval","hitIds","window","document","forEach","id","element","getElementById","inViewPort","hitObject","find","hit","_id","addToWaitingList","recordImpression","queryId","impression","index","_index","push","keys","trackImpressions","untrackedHits","componentDidMount","hits","setCurrentHits","addEventListener","componentDidUpdate","prevProps","prevHitIds","map","currentHitIds","isEqual","componentWillUnmount","el","rect","getBoundingClientRect","top","left","bottom","innerHeight","documentElement","clientHeight","right","innerWidth","clientWidth","render","children","get","_this2","filter","state","context","store","getState","analytics","searchId","Component","contextType","ReactReduxContext","propTypes","funcRequired","node","mapDispatchToProps","dispatch","queryID","impressions","recordImpressions","connect"],"mappings":"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","sourcesContent":["'use strict';\n\nexports.__esModule = true;\n\nvar _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _react = require('react');\n\nvar _react2 = _interopRequireDefault(_react);\n\nvar _propTypes = require('prop-types');\n\nvar _types = require('@appbaseio/reactivecore/lib/utils/types');\n\nvar _types2 = _interopRequireDefault(_types);\n\nvar _helper = require('@appbaseio/reactivecore/lib/utils/helper');\n\nvar _actions = require('@appbaseio/reactivecore/lib/actions');\n\nvar _utils = require('../../../utils');\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nvar debounce = function debounce(method, delay) {\n\tclearTimeout(method._tId);\n\t// eslint-disable-next-line\n\tmethod._tId = setTimeout(function () {\n\t\tmethod();\n\t}, delay);\n};\n\nvar ImpressionTracker = function (_React$Component) {\n\t_inherits(ImpressionTracker, _React$Component);\n\n\tfunction ImpressionTracker() {\n\t\tvar _temp, _this, _ret;\n\n\t\t_classCallCheck(this, ImpressionTracker);\n\n\t\tfor (var _len = arguments.length, args = Array(_len), _key = 0; _key < _len; _key++) {\n\t\t\targs[_key] = arguments[_key];\n\t\t}\n\n\t\treturn _ret = (_temp = (_this = _possibleConstructorReturn(this, _React$Component.call.apply(_React$Component, [this].concat(args))), _this), _this.currentHits = [], _this.trackedIds = {}, _this.waitingToBeTracked = {}, _this.setTrackerInterval = function () {\n\t\t\t_this.intervalID = setInterval(_this.tracker, 1000);\n\t\t}, _this.clearTrackerInterval = function () {\n\t\t\tif (_this.intervalID) {\n\t\t\t\tclearInterval(_this.intervalID);\n\t\t\t\t// Reset interval ID\n\t\t\t\t_this.intervalID = null;\n\t\t\t}\n\t\t}, _this.tracker = function () {\n\t\t\tif (!_this.hitIds.length) {\n\t\t\t\t_this.clearTrackerInterval();\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t// only run at client-side\n\t\t\tif (window && document) {\n\t\t\t\t_this.hitIds.forEach(function (id) {\n\t\t\t\t\tvar element = document.getElementById(id);\n\t\t\t\t\tif (element) {\n\t\t\t\t\t\tif (_this.inViewPort(element)) {\n\t\t\t\t\t\t\t// Add the hit id in the list of tracked ids\n\t\t\t\t\t\t\tvar hitObject = _this.currentHits.find(function (hit) {\n\t\t\t\t\t\t\t\treturn hit._id === id;\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t_this.trackedIds[id] = true;\n\t\t\t\t\t\t\t// Add hit to waiting list to be recorded\n\t\t\t\t\t\t\t_this.addToWaitingList(hitObject);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t\tdebounce(_this.recordImpression, 300);\n\t\t}, _this.addToWaitingList = function (hitObject) {\n\t\t\tvar queryId = _this.queryId;\n\t\t\tif (hitObject && queryId) {\n\t\t\t\tvar impression = {\n\t\t\t\t\tid: hitObject._id,\n\t\t\t\t\tindex: hitObject._index\n\t\t\t\t};\n\t\t\t\t// Check if query id already present in waiting list\n\t\t\t\tif (_this.waitingToBeTracked[queryId]) {\n\t\t\t\t\t_this.waitingToBeTracked[queryId].push(impression);\n\t\t\t\t} else {\n\t\t\t\t\t_this.waitingToBeTracked[queryId] = [impression];\n\t\t\t\t}\n\t\t\t}\n\t\t}, _this.recordImpression = function () {\n\t\t\tif (Object.keys(_this.waitingToBeTracked).length) {\n\t\t\t\tvar trackImpressions = _this.props.trackImpressions;\n\n\t\t\t\tvar untrackedHits = _extends({}, _this.waitingToBeTracked);\n\t\t\t\tObject.keys(untrackedHits).forEach(function (queryId) {\n\t\t\t\t\tif (untrackedHits[queryId] && untrackedHits[queryId].length) {\n\t\t\t\t\t\ttrackImpressions(queryId, untrackedHits[queryId]);\n\t\t\t\t\t\t// Removed tracked impressions from waiting list\n\t\t\t\t\t\tdelete _this.waitingToBeTracked[queryId];\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}, _temp), _possibleConstructorReturn(_this, _ret);\n\t}\n\t// Represents the list of hits returned by the query\n\t// An array of hits objects\n\t// An object to track the recorded impressions\n\t// It can have the values in following shape\n\t// { \"hit_id\": { \"index\": \"test\" }}\n\n\t// An object to know the the untracked impression i.e not recorded by BE\n\t// It can have the values in following shape\n\t// { \"query_id\": [{ \"id\": \"hit_id\", \"index\": \"test\"}]}\n\n\n\tImpressionTracker.prototype.componentDidMount = function componentDidMount() {\n\t\tvar hits = this.props.hits;\n\n\t\tthis.setCurrentHits(hits);\n\t\t// Add scroll events to track the impressions\n\t\tif (window) {\n\t\t\twindow.addEventListener('scroll', this.tracker);\n\t\t}\n\t};\n\n\tImpressionTracker.prototype.componentDidUpdate = function componentDidUpdate(prevProps) {\n\t\tvar hits = this.props.hits;\n\n\t\tif (hits && hits !== prevProps.hits) {\n\t\t\t// Only compare hit ids for performance reasons\n\t\t\tvar prevHitIds = prevProps.hits.map(function (hit) {\n\t\t\t\treturn hit._id;\n\t\t\t});\n\t\t\tvar currentHitIds = hits.map(function (hit) {\n\t\t\t\treturn hit._id;\n\t\t\t});\n\t\t\tif (!(0, _helper.isEqual)(currentHitIds, prevHitIds)) {\n\t\t\t\tthis.setCurrentHits(hits);\n\t\t\t}\n\t\t}\n\t};\n\n\tImpressionTracker.prototype.componentWillUnmount = function componentWillUnmount() {\n\t\t// Clear the interval\n\t\tthis.clearTrackerInterval();\n\t};\n\n\tImpressionTracker.prototype.inViewPort = function inViewPort(el) {\n\t\tvar rect = el.getBoundingClientRect();\n\t\treturn rect.top >= 0 && rect.left >= 0 && rect.bottom <= (window.innerHeight || document.documentElement.clientHeight) && rect.right <= (window.innerWidth || document.documentElement.clientWidth);\n\t};\n\n\tImpressionTracker.prototype.setCurrentHits = function setCurrentHits(hits) {\n\t\tthis.currentHits = hits;\n\t\t// Reset the tracked Ids for new hits\n\t\tthis.trackedIds = {};\n\t\tif (hits.length) {\n\t\t\tthis.tracker();\n\t\t\t// Run the tracker function on an interval of 1s to track the impressions for\n\t\t\t// non-scroll views for e.g on tab change\n\t\t\tthis.setTrackerInterval();\n\t\t}\n\t};\n\n\tImpressionTracker.prototype.render = function render() {\n\t\tvar children = this.props.children;\n\n\t\treturn children;\n\t};\n\n\t_createClass(ImpressionTracker, [{\n\t\tkey: 'hitIds',\n\t\tget: function get() {\n\t\t\tvar _this2 = this;\n\n\t\t\treturn this.currentHits.map(function (hit) {\n\t\t\t\treturn hit._id;\n\t\t\t}).filter(function (id) {\n\t\t\t\treturn !_this2.trackedIds[id];\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: 'queryId',\n\t\tget: function get() {\n\t\t\tvar state = this.context && this.context.store ? this.context.store.getState() : null;\n\n\t\t\treturn state ? state.analytics.searchId : null;\n\t\t}\n\t}]);\n\n\treturn ImpressionTracker;\n}(_react2.default.Component);\n\nImpressionTracker.contextType = _utils.ReactReduxContext;\n\n\nImpressionTracker.propTypes = {\n\ttrackImpressions: _types2.default.funcRequired,\n\thits: _types2.default.hits,\n\tchildren: _propTypes.node\n};\n\nvar mapDispatchToProps = function mapDispatchToProps(dispatch) {\n\treturn {\n\t\ttrackImpressions: function trackImpressions(queryID, impressions) {\n\t\t\treturn dispatch((0, _actions.recordImpressions)(queryID, impressions));\n\t\t}\n\t};\n};\n\nexports.default = (0, _utils.connect)(null, mapDispatchToProps)(ImpressionTracker);"]},"metadata":{},"sourceType":"script"}